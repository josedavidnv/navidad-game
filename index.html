<!doctype html>
<html lang="es" data-theme="dark">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Juego Navide√±o</title>
    <link rel="stylesheet" href="./styles.css" />
</head>

<body>
    <!-- Snow canvas (full screen) -->
    <canvas id="snowCanvas" aria-hidden="true"></canvas>

    <!-- Background music (loop) -->
    <audio id="bgMusic" src="./xmas.mp3" loop preload="auto"></audio>

    <!-- Corner toggles (solo local) -->
    <button id="cornerToggleBtn" class="cornerToggle" title="Ajustes visuales">‚öôÔ∏è</button>
    <div id="cornerPanel" class="cornerPanel hidden">
        <div class="cornerRow">
            <span>‚ùÑÔ∏è Nieve</span>
            <button id="toggleSnow" class="miniBtn">ON</button>
        </div>

        <div class="cornerRow" style="justify-content: space-around"><input id="snowSpeed" type="range" min="0.2"
                max="1.6" step="0.05" value="0.2" />
        </div>

        <div class="cornerRow">
            <span>üîä Sonidos</span>
            <button id="toggleSound" class="miniBtn">ON</button>
        </div>

        <div class="cornerRow">
            <span>üé∂ M√∫sica</span>
            <button id="toggleMusic" class="miniBtn">ON</button>
        </div>

        <div class="cornerRow">
            <span>üåó Tema</span>
            <button id="toggleTheme" class="miniBtn">Oscuro</button>
        </div>
    </div>

    <div class="wrap">
        <div class="garland" aria-hidden="true"></div>

        <header class="top">
            <h1 id="gameTitle">üéÑ Juego Navide√±o</h1>
            <p class="muted" id="subtitle">Entra, espera a tus amigos y empezad.</p>
        </header>

        <!-- PANTALLA: INICIO -->
        <section class="card" id="screen-landing">
            <h2>Entrar</h2>
            <div class="grid">
                <label>
                    Tu nombre
                    <input id="nameInput" maxlength="24" placeholder="Ej: Marta" autocomplete="nickname" />
                </label>

                <label>
                    C√≥digo de sala
                    <input id="roomInput" maxlength="12" placeholder="Ej: X7K9Q" />
                </label>
            </div>

            <div class="row">
                <button id="btnCreate">Crear sala</button>
                <button id="btnJoin" class="primary">Unirme</button>
            </div>

            <p class="muted small">
                Consejo: si creas sala, comparte el c√≥digo por WhatsApp.
            </p>
        </section>

        <!-- PANTALLA: LOBBY / ESPERA -->
        <section class="card hidden" id="screen-lobby">
            <div class="row space">
                <div>
                    <h2>
                        Sala:
                        <span id="roomCodeText"></span>
                        <button id="btnCopyRoom" class="iconBtn" title="Copiar c√≥digo">üìã</button>
                    </h2>
                    <p class="muted small">Comparte este c√≥digo con tus amigos.</p>
                </div>
                <button id="btnLeaveLobby" class="ghost">Salir</button>
            </div>

            <div class="card-inner">
                <h3>Gente en la sala</h3>
                <ul id="playersList" class="list"></ul>
                <p class="muted small" style="margin:10px 0 0;">
                    Nota: si alguien se queda sin conexi√≥n, seguir√° aqu√≠ marcado como <b>offline</b> hasta que vuelva o
                    el host lo elimine.
                </p>
            </div>

            <!-- SOLO HOST -->
            <div class="card-inner" id="hostLobbyControls" style="display:none">
                <div class="row space" style="margin-top:0">
                    <h3 style="margin:0">
                        Ajustes (solo host)
                    </h3>
                    <div class="countsPill" id="actionsCountsLobby">‚Äî</div>
                </div>

                <label class="check">
                    <input type="checkbox" id="chkNoRepeat" checked />
                    Sin repetici√≥n (las acciones usadas no vuelven a salir)
                </label>

                <label class="check">
                    <input type="checkbox" id="chkUseWildcard" />
                    Jugar con comod√≠n
                </label>

                <label class="check">
                    <input type="checkbox" id="chkLockJoin" checked />
                    Cerrar sala al empezar (solo pueden re-entrar los que ya estaban)
                </label>

                <label style="margin-top:10px; display:block;">
                    Castigo si alguien no hace su acci√≥n
                    <input id="punishmentInput" placeholder="Ej: 1 chupito / 20 sentadillas" />
                </label>

                <div class="row" style="margin-top:10px;">
                    <input id="newActionInput" placeholder="A√±adir acci√≥n personalizada" />
                    <button id="btnAddAction">A√±adir</button>
                </div>

                <details class="card-inner" style="margin-top:12px;">
                    <summary class="summaryRow">
                        <b>Gestionar acciones</b>
                        <span class="muted small" id="actionsCountsLobby2">‚Äî</span>
                    </summary>

                    <div class="row" style="margin-top:10px; flex-wrap:wrap;">
                        <button id="btnEnableAll" class="ghost">Marcar todas</button>
                        <button id="btnDisableAll" class="ghost">Desmarcar todas</button>
                    </div>

                    <div class="actionsBox" id="actionsBox"></div>

                    <p class="muted small" style="margin-top:10px;">
                        Nota: En ‚Äúsin repetici√≥n‚Äù, cuando una acci√≥n salga, se desmarcar√° autom√°ticamente (pero puedes
                        reactivarla).
                    </p>
                </details>

                <ul id="customActionsList" class="list small"></ul>
            </div>

            <!-- SOLO HOST -->
            <div class="row" id="hostLobbyStartRow" style="display:none">
                <button id="btnStart" class="primary">Empezar a jugar</button>
            </div>

            <p class="muted small" id="hostHint"></p>
        </section>

        <!-- PANTALLA: JUEGO -->
        <section class="card hidden" id="screen-game">
            <div class="row space">
                <div>
                    <h2>Partida</h2>
                    <p class="muted small">
                        Sala:
                        <span id="roomCodeText2"></span>
                        <button id="btnCopyRoom2" class="iconBtn" title="Copiar c√≥digo">üìã</button>
                    </p>
                </div>
                <button id="btnLeaveGame" class="ghost">Salir</button>
            </div>

            <div class="big" id="gameTopGrid">
                <div class="pill" id="wildcardPill">üéÅ Comod√≠n: ‚Äî</div>

                <div class="you" id="youCard">
                    <div class="muted small">T√∫ eres</div>
                    <div class="youName" id="youName">‚Äî</div>
                    <div class="youRole" id="youRole">‚Äî</div>

                    <button id="youExecBtn" class="execBtn" type="button">
                        ‚úÖ Marcar como hecha
                    </button>
                    <div class="muted small" id="youExecHint"></div>
                </div>
            </div>

            <div class="card-inner">
                <h3>Asignaciones</h3>
                <div class="muted small">Todos ven qui√©n tiene qu√© acci√≥n.</div>
                <table class="table" id="assignmentsTable">
                    <thead>
                        <tr>
                            <th>Jugador</th>
                            <th>Acci√≥n</th>
                            <th>Hecha</th>
                        </tr>
                    </thead>
                    <tbody id="assignmentsBody"></tbody>
                </table>
            </div>

            <div class="card-inner">
                <h3>Info</h3>
                <p class="muted small" id="roundInfo">‚Äî</p>
                <p class="muted small" id="punishmentInfo"></p>
            </div>

            <!-- SOLO HOST (en partida) -->
            <div class="card-inner" id="hostGameControls" style="display:none">
                <div class="row space" style="margin-top:0">
                    <h3 style="margin:0">Ajustes en partida (solo host)</h3>
                    <div class="countsPill" id="actionsCountsGame">‚Äî</div>
                </div>

                <label class="check">
                    <input type="checkbox" id="g_chkNoRepeat" />
                    Sin repetici√≥n
                </label>

                <label class="check">
                    <input type="checkbox" id="g_chkUseWildcard" />
                    Jugar con comod√≠n
                </label>

                <label class="check">
                    <input type="checkbox" id="g_chkLockJoin" />
                    Cerrar sala
                </label>

                <label style="margin-top:10px; display:block;">
                    Castigo
                    <input id="g_punishmentInput" />
                </label>

                <div class="row" style="margin-top:10px;">
                    <input id="g_newActionInput" placeholder="A√±adir acci√≥n personalizada" />
                    <button id="g_btnAddAction">A√±adir</button>
                </div>

                <details class="card-inner" style="margin-top:12px;">
                    <summary class="summaryRow">
                        <b>Gestionar acciones</b>
                        <span class="muted small" id="actionsCountsGame2">‚Äî</span>
                    </summary>

                    <div class="row" style="margin-top:10px; flex-wrap:wrap;">
                        <button id="g_btnEnableAll" class="ghost">Marcar todas</button>
                        <button id="g_btnDisableAll" class="ghost">Desmarcar todas</button>
                    </div>

                    <div class="actionsBox" id="g_actionsBox"></div>
                </details>
            </div>
        </section>

        <!-- OVERLAY: SIN ACCIONES -->
        <div class="overlay hidden" id="overlayNoActions">
            <div class="overlayCard">
                <h2>üéÖ No quedan m√°s acciones</h2>
                <p class="muted">
                    Ya no hay acciones disponibles con los filtros actuales.
                </p>

                <div class="row" style="justify-content:center; flex-wrap:wrap;" id="overlayBtnsHost">
                    <button id="btnOverlayEnableAll" class="primary">Marcar todas</button>
                    <button id="btnExitNoActions" class="ghost">Salir</button>
                </div>

                <div class="row" style="justify-content:center; flex-wrap:wrap;" id="overlayBtnsUser">
                    <button id="btnExitNoActions2" class="ghost">Salir</button>
                </div>
            </div>
        </div>

        <footer class="foot muted small">
            Hecho por Jose David. ¬°Feliz Navidad! üéÖüéÅ
        </footer>
    </div>

    <!-- Firebase config -->
    <script src="./firebaseConfig.js"></script>

    <!-- App -->
    <script type="module" src="./app.js"></script>
</body>

</html>